# Recreate the standalone prototype file and confirm the path.
from textwrap import dedent
from pathlib import Path

html = dedent("""\
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Limerick GAA Hub — Stats Prototype</title>
<style>
  :root{
    --bg:#fff; --text:#111; --muted:#666; --line:#eee;
    --green-start:#2e7d32; --green-sub:#a5d6a7; --chip:#f4f4f4;
    --accent:#0e7aff;
  }
  body{font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, "Apple Color Emoji","Segoe UI Emoji"; margin:0; color:var(--text); background:var(--bg);}
  header.top{position:sticky; top:0; background:var(--bg); border-bottom:1px solid var(--line); z-index:10;}
  .container{max-width:1100px; margin:0 auto; padding:12px 16px;}
  .seg{display:inline-flex; border:1px solid var(--line); border-radius:999px; overflow:hidden;}
  .seg button{padding:.5rem .9rem; border:0; background:none; cursor:pointer; font-weight:600;}
  .seg button[aria-pressed="true"]{background:var(--accent); color:#fff;}
  .bar{display:flex; gap:.75rem; align-items:center; flex-wrap:wrap; margin:.6rem 0 .2rem;}
  .bar select,.bar .pill{padding:.4rem .6rem; border:1px solid var(--line); border-radius:.4rem; background:#fff;}
  .hint{color:var(--muted); font-size:.9em;}
  .kpis{display:flex; gap:1rem; flex-wrap:wrap; margin:.6rem 0;}
  .tile{padding:.6rem .7rem; border:1px solid var(--line); border-radius:.5rem; background:#fff;}
  /* table */
  .table-wrap{overflow:auto;}
  table{border-collapse:collapse; width:100%; min-width:720px;}
  th, td{border-bottom:1px solid var(--line); padding:.35rem .45rem; white-space:nowrap; text-align:center; font-variant-numeric: tabular-nums;}
  th:first-child, td:first-child{text-align:left; position:sticky; left:0; background:var(--bg); z-index:1;}
  th:last-child, td:last-child{position:sticky; right:0; background:var(--bg); z-index:1;}
  thead th{position:sticky; top:52px; background:var(--bg); z-index:5;}
  .round-label{display:flex; flex-direction:column; line-height:1.05;}
  .round-label small{color:var(--muted); font-size:.75em;}
  .cell{position:relative; border-radius:.35rem;}
  .cell .badge{position:absolute; top:.15rem; right:.2rem; font-size:.70em; background:rgba(255,255,255,.8); padding:0 .25rem; border-radius:.3rem;}
  .role-start{background: color-mix(in srgb, var(--green-start) 22%, white);}
  .role-sub{background: color-mix(in srgb, var(--green-sub) 55%, white);}
  .chips{font-size:.85em; color:#333;}
  .chips .chip{display:inline-block; padding:0 .35rem; border-radius:.4rem; background:var(--chip); margin-left:.2rem;}
  .legend{margin:.5rem 0; color:var(--muted); font-size:.9em;}
  details.guide{margin:1rem 0; border:1px solid var(--line); border-radius:.5rem; padding:.6rem .7rem; background:#fff;}
  details.guide summary{cursor:pointer; font-weight:600;}
  /* leaderboards */
  .lb-bar{display:flex; gap:.5rem; flex-wrap:wrap; align-items:center; margin:.5rem 0;}
  .lb-list{border:1px solid var(--line); border-radius:.5rem; overflow:hidden;}
  .lb-list li{display:flex; gap:.5rem; justify-content:space-between; padding:.5rem .7rem; border-bottom:1px solid var(--line);}
  .lb-list li:last-child{border-bottom:0;}
  .rank{width:2.2rem; text-align:right; color:var(--muted);}
  .name{flex:1 1 auto; min-width:0; overflow:hidden; text-overflow:ellipsis;}
  .value{font-weight:700;}
  /* utilities */
  .sr{position:absolute; left:-9999px;}
  .muted{color:var(--muted);}
  .right{margin-left:auto;}
</style>
</head>
<body>
<header class="top">
  <div class="container">
    <div style="display:flex; align-items:center; gap:.75rem; justify-content:space-between;">
      <h1 style="font-size:1.2rem; margin:0;">Stats</h1>
      <div class="seg" role="tablist" aria-label="Stats views">
        <button id="tab-team" role="tab" aria-selected="true" aria-pressed="true">By Team</button>
        <button id="tab-lb" role="tab" aria-selected="false" aria-pressed="false">Leaderboards</button>
      </div>
    </div>
  </div>
</header>

<main id="team-view">
  <div class="container">
    <div class="bar">
      <label for="teamSel" class="sr">Team</label>
      <select id="teamSel"></select>
      <label for="scopeSel" class="sr">Scope</label>
      <select id="scopeSel">
        <option value="season">Season</option>
        <option value="round:R1">This round (R1)</option>
        <option value="round:R2">This round (R2)</option>
        <option value="round:R3">This round (R3)</option>
        <option value="round:R4">This round (R4)</option>
        <option value="round:R5">This round (R5)</option>
      </select>
      <span class="right hint">as of <strong id="asOf">R4</strong></span>
    </div>

    <div class="legend">Legend: <strong>S</strong> = started (dark), <strong>⊕</strong> = sub on (light), blank = DNP/unknown. Tokens: <strong>F</strong>=frees, <strong>65</strong>, <strong>SL</strong>=sideline, <strong>P</strong>=penalties (g–p).</div>

    <div class="table-wrap" id="gridWrap"></div>

    <details class="guide">
      <summary>Round key — <span id="rk-team">TEAM</span> (as of <span id="rk-asof">R4</span>)</summary>
      <div id="roundKey" style="margin-top:.5rem; font-variant-numeric: tabular-nums;"></div>
    </details>
  </div>
</main>

<main id="lb-view" style="display:none;">
  <div class="container">
    <div class="lb-bar">
      <label for="subSel" class="sr">Subject</label>
      <select id="subSel">
        <option value="team">Team</option>
        <option value="player">Player</option>
        <option value="match">Matches</option>
      </select>
      <label for="metricSel" class="sr">Metric</label>
      <select id="metricSel"></select>
      <label for="scopeLbSel" class="sr">Scope</label>
      <select id="scopeLbSel">
        <option value="season">Season</option>
        <option value="round:R1">R1</option>
        <option value="round:R2">R2</option>
        <option value="round:R3">R3</option>
        <option value="round:R4">R4</option>
        <option value="round:R5">R5</option>
      </select>
      <label for="showSel" class="sr">Show</label>
      <select id="showSel">
        <option value="5">Top 5</option>
        <option value="10">Top 10</option>
        <option value="9999">All</option>
      </select>
      <span class="right hint">as of <strong id="asOfLb">R4</strong></span>
    </div>

    <ol class="lb-list" id="lbList" aria-live="polite"></ol>
  </div>
</main>

<script>
// ------- Sample data (inline for prototype) -------
const OPP = {"BB":"Ballybrown","AHA":"Ahane","DOO":"Doon","PW":"Patrickswell","NAP":"Na Piarsaigh","KIL":"Kilmallock","ADA":"Adare","MON":"Monaleen","MSP":"Mungret St Paul's","NCW":"Newcastle West","KP":"Kildimo/Pallaskenry","DA":"Dromin/Athlacca"};

const SAMPLE = {
  as_of_round: "R4",
  rounds: ["R1","R2","R3","R4","R5"],
  fixtures: {
    // For Round key; minimal illustration
    "DOO": {
      "R1": { opp:"BB", date:"2025-08-02", our:"2-20", their:"2-17", res:"+3" },
      "R2": { opp:"NAP", date:"2025-08-08", our:"0-14", their:"2-18", res:"-8" },
      "R3": { opp:"KIL", date:"2025-08-15", our:"1-20", their:"0-18", res:"+5" },
      "R4": { opp:"AHA", date:"2025-08-29", our:"2-16", their:"2-16", res:"0" },
      "R5": { opp:"PW", date:"2025-09-05" }
    }
  },
  teams: {
    "Doon": {
      code: "DOO",
      players: [
        { name:"Adam English", rounds:{
          R1:{ role:"S", tally:"0-5", tokens:{f:3} },
          R2:{ role:"S", tally:"0-5", tokens:{f:3} },
          R3:{ role:"S", tally:"0-8", tokens:{"65":1} },
          R4:{ role:"S", tally:"1-2", tokens:{pen:{g:1,p:0}} },
          R5:{ role:"-", tally:null }
        }},
        { name:"Darragh O’Donovan", rounds:{
          R1:{ role:"S", tally:"0-3", tokens:{} },
          R2:{ role:"⊕", tally:"0-2", tokens:{} },
          R3:{ role:"S", tally:"0-2", tokens:{} },
          R4:{ role:"S", tally:null },
          R5:{ role:"-", tally:null }
        }},
        { name:"Chris Thomas", rounds:{
          R1:{ role:"⊕", tally:"0-1", tokens:{} },
          R2:{ role:"S", tally:"0-3", tokens:{} },
          R3:{ role:"⊕", tally:"0-2", tokens:{} },
          R4:{ role:"S", tally:"0-1", tokens:{} },
          R5:{ role:"⊕", tally:null }
        }}
      ]
    },
    "Na Piarsaigh": {
      code:"NAP",
      players: [
        { name:"Kevin Downes", rounds:{
          R1:{ role:"S", tally:"0-5", tokens:{f:3} },
          R2:{ role:"S", tally:"0-5", tokens:{f:3} },
          R3:{ role:"S", tally:"0-8", tokens:{"65":1} },
          R4:{ role:"S", tally:"1-2", tokens:{pen:{g:1,p:0}} },
          R5:{ role:"-", tally:null }
        }},
        { name:"Adrian Breen", rounds:{
          R1:{ role:"S", tally:"0-2", tokens:{} },
          R2:{ role:"S", tally:"0-2", tokens:{} },
          R3:{ role:"S", tally:"1-3", tokens:{} },
          R4:{ role:"S", tally:"0-1", tokens:{} },
          R5:{ role:"-", tally:null }
        }}
      ]
    }
  },
  leaderboards: {
    team:{
      most_players_used: [
        {team:"Doon", value:32, games:5},
        {team:"Na Piarsaigh", value:30, games:5},
        {team:"Ahane", value:28, games:5},
        {team:"Kilmallock", value:27, games:5},
        {team:"Ballybrown", value:27, games:5}
      ],
      most_subs_used_avg: [
        {team:"Doon", value:4.6, subs_total:23, games:5},
        {team:"Ahane", value:4.2, subs_total:21, games:5},
        {team:"Na Piarsaigh", value:4.0, subs_total:20, games:5},
        {team:"Kilmallock", value:3.8, subs_total:19, games:5},
        {team:"Ballybrown", value:3.7, subs_total:18, games:5}
      ]
    },
    match:{
      biggest_margins:[
        {round:"R4", home:"Doon", away:"Ballybrown", home_tally:"2-25", away_tally:"1-12", margin_pts:16}
      ]
    },
    player:{
      top_scorers_total:[
        {player:"Kevin Downes", team:"Na Piarsaigh", g:1, p:20, pts:23},
        {player:"Aidan O’Connor", team:"Ballybrown", g:0, p:13, pts:13}
      ]
    }
  }
};

// ------- Helpers -------
const rounds = SAMPLE.rounds;
function oppCodeFor(teamCode, r){
  const fx = SAMPLE.fixtures[teamCode]?.[r];
  return fx?.opp || "";
}
function oppName(code){ return OPP[code] || code || ""; }

function tokensToChips(tokens){
  if(!tokens) return "";
  const parts=[];
  if(tokens.f) parts.push(`F${tokens.f}`);
  if(tokens["65"]) parts.push(`65×${tokens["65"]}`);
  if(tokens.sl) parts.push(`SL${tokens.sl}`);
  if(tokens.pen){ const g=tokens.pen.g||0, p=tokens.pen.p||0; parts.push(`P${g}-${p}`); }
  return parts.join(" ");
}

// Compute per-player aggregates for Total / From play / Placed
function parseTally(t){ if(!t) return {g:0,p:0,pts:0}; const [g,p]=String(t).split("-").map(x=>+x||0); return {g,p,pts:3*g+p}; }
function aggPlayer(player){
  let G=0,P=0, placed_pts=0, placed_g=0, placed_p=0;
  for(const r of rounds){
    const cell = player.rounds[r];
    if(!cell || !cell.tally) continue;
    const {g,p,pts} = parseTally(cell.tally);
    G+=g; P+=p;
    const t=cell.tokens||{};
    placed_pts += (t.f||0) + (t["65"]||0) + (t.sl||0) + 3*((t.pen&&t.pen.g)||0) + ((t.pen&&t.pen.p)||0);
    placed_g += (t.pen&&t.pen.g)||0;
    placed_p += (t.f||0) + (t["65"]||0) + (t.sl||0) + ((t.pen&&t.pen.p)||0);
  }
  const total = {g:G,p:P,pts:3*G+P};
  const play_pts = total.pts - placed_pts;
  // Split play back to G-P estimate: goals from play = G - placed_g; points from play = P - placed_p
  const play = {g: Math.max(0, G - placed_g), p: Math.max(0, P - placed_p)};
  const placed = {g: placed_g, p: placed_p, pts: placed_pts};
  return {total, play, placed};
}

// ------- Render Team grid -------
function renderTeam(teamName){
  const team = SAMPLE.teams[teamName];
  const teamCode = team.code;
  document.getElementById("asOf").textContent = SAMPLE.as_of_round;
  document.getElementById("rk-team").textContent = teamName;
  document.getElementById("rk-asof").textContent = SAMPLE.as_of_round;

  // Build table
  let html = '<table aria-label="Team Scorers and Appearances"><thead><tr>';
  html += '<th>Player</th>';
  for(const r of rounds){
    const oc = oppCodeFor(teamCode, r);
    html += `<th><span class="round-label">${r}<small>v ${oc||"—"}</small></span></th>`;
  }
  html += '<th>Total</th><th>From play</th><th>Placed</th><th>Starts</th><th>Subs</th><th>Apps</th>';
  html += '</tr></thead><tbody>';

  for(const p of team.players){
    // counts for starts/subs/apps
    let starts=0, subs=0, apps=0;
    for(const r of rounds){
      const cell = p.rounds[r]; if(!cell) continue;
      if(cell.role==="S") {starts++; apps++;}
      else if(cell.role==="⊕"){subs++; apps++;}
    }
    const agg = aggPlayer(p);

    html += `<tr><td>${p.name}</td>`;
    for(const r of rounds){
      const cell = p.rounds[r] || {};
      const role = cell.role;
      const cls = role==="S" ? "role-start" : role==="⊕" ? "role-sub" : "";
      const tally = cell.tally || "—";
      const chips = tokensToChips(cell.tokens||{});
      const badge = role==="S" ? "S" : role==="⊕" ? "⊕" : "";
      html += `<td class="${cls} cell" title="${r}: ${tally}${chips? " • "+chips:""}">${tally}${chips? `<div class="chips"><span class="chip">${chips}</span></div>`:""}${badge?`<span class="badge">${badge}</span>`:""}</td>`;
    }
    const totalGP = `${agg.total.g}-${agg.total.p}`;
    const playGP = `${agg.play.g}-${agg.play.p}`;
    const placedChips = [];
    if(agg.placed.p) placedChips.push(`F/65/SL ${agg.placed.p}`);
    if(agg.placed.g) placedChips.push(`P${agg.placed.g}-0`);
    html += `<td>${totalGP}</td><td>${playGP}</td><td>${placedChips.join(" ")||"—"}</td>`;
    html += `<td>${starts}</td><td>${subs}</td><td>${apps}</td>`;
    html += `</tr>`;
  }

  html += '</tbody></table>';
  document.getElementById("gridWrap").innerHTML = html;

  // Round key
  const fx = SAMPLE.fixtures[teamCode]||{};
  let rk = '';
  for(const r of rounds){
    const f = fx[r];
    if(!f){ rk += `${r}  v —<br/>`; continue; }
    const opp = oppName(f.opp);
    const date = f.date ? ` (${f.date})` : '';
    const res = (f.our && f.their) ? ` — ${f.our} to ${f.their} (${f.res})` : '';
    rk += `${r}  v ${opp}${date}${res}<br/>`;
  }
  document.getElementById("roundKey").innerHTML = rk;
}

// ------- Render Leaderboards -------
const METRICS = {
  team: [
    {key:"most_players_used", label:"Most players used"},
    {key:"most_subs_used_avg", label:"Most subs used (avg/game)"},
  ],
  player: [
    {key:"top_scorers_total", label:"Top scorers (total)"}
  ],
  match: [
    {key:"biggest_margins", label:"Biggest winning margins"}
  ]
};

function populateTeamSelector(){
  const sel = document.getElementById("teamSel");
  const teams = Object.keys(SAMPLE.teams).sort();
  sel.innerHTML = teams.map(t=>`<option value="${t}">${t}</option>`).join("");
  renderTeam(teams[0]);
}

function initLeaderboards(){
  document.getElementById("asOfLb").textContent = SAMPLE.as_of_round;
  const subSel = document.getElementById("subSel");
  const metricSel = document.getElementById("metricSel");
  function refreshMetrics(){
    const subject = subSel.value;
    metricSel.innerHTML = METRICS[subject].map(m=>`<option value="${m.key}">${m.label}</option>`).join("");
  }
  refreshMetrics();

  function renderLb(){
    const subject = subSel.value;
    const metric = metricSel.value;
    const scope = document.getElementById("scopeLbSel").value; // prototype ignores scope filters
    const n = +document.getElementById("showSel").value;

    const arr = (SAMPLE.leaderboards[subject]||{})[metric] || [];
    const list = document.getElementById("lbList");
    list.innerHTML = (arr.slice(0,n)).map((row,i)=>{
      if(subject==="team"){
        if(metric==="most_players_used"){
          return `<li><span class="rank">${i+1}</span><span class="name">${row.team}</span><span class="value">${row.value}</span><span class="muted">(${row.games} g)</span></li>`;
        }else if(metric==="most_subs_used_avg"){
          return `<li><span class="rank">${i+1}</span><span class="name">${row.team}</span><span class="value">${row.value.toFixed(1)}</span><span class="muted">(${row.subs_total} / ${row.games}g)</span></li>`;
        }
      }else if(subject==="player"){
        return `<li><span class="rank">${i+1}</span><span class="name">${row.player} — ${row.team}</span><span class="value">${row.g}-${row.p}</span><span class="muted">${row.pts} pts</span></li>`;
      }else if(subject==="match"){
        return `<li><span class="rank">${i+1}</span><span class="name">${row.round} ${row.home} ${row.home_tally} v ${row.away} ${row.away_tally}</span><span class="value">+${row.margin_pts}</span></li>`;
      }
      return `<li><span class="rank">${i+1}</span><span class="name">Unknown</span></li>`;
    }).join("");
  }

  document.getElementById("subSel").addEventListener("change", ()=>{ refreshMetrics(); renderLb(); });
  document.getElementById("metricSel").addEventListener("change", renderLb);
  document.getElementById("scopeLbSel").addEventListener("change", renderLb);
  document.getElementById("showSel").addEventListener("change", renderLb);
  renderLb();
}

// ------- Tabs -------
const teamTab = document.getElementById("tab-team");
const lbTab   = document.getElementById("tab-lb");
teamTab.addEventListener("click", ()=>{
  teamTab.setAttribute("aria-pressed","true"); lbTab.setAttribute("aria-pressed","false");
  document.getElementById("team-view").style.display="";
  document.getElementById("lb-view").style.display="none";
});
lbTab.addEventListener("click", ()=>{
  lbTab.setAttribute("aria-pressed","true"); teamTab.setAttribute("aria-pressed","false");
  document.getElementById("team-view").style.display="none";
  document.getElementById("lb-view").style.display="";
});

// ------- Bootstrap -------
populateTeamSelector();
document.getElementById("teamSel").addEventListener("change", (e)=> renderTeam(e.target.value));
initLeaderboards();
</script>
</body>
</html>
""")

p = Path("/mnt/data/stats_prototype.html")
p.write_text(html, encoding="utf-8")
print(str(p))
